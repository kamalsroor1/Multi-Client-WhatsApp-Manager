# ุฅุตูุงุญ ูุดููุฉ ุนุฑุถ ุงููุฌููุนุงุช ูููุชุฑ ุขุฎุฑ 90 ููู

## ุงููุดููุฉ ุงูุชู ุชู ุญููุง

ูุงู ุงููุธุงู ูุณุชุฎุฏู ุจูุงูุงุช ููููุฉ (mock data) ุจุฏูุงู ูู ุฌูุจ ุงูุจูุงูุงุช ุงููุนููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ููู ููู ูุทุจู ููุชุฑ ุขุฎุฑ 90 ููู ุนูู ุฌูุงุช ุงูุงุชุตุงู.

## โ ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ (ูุชูุงููุฉ ูุน ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ)

### 1. ุชุญุฏูุซ GroupService.js

**ุงูุชุญุณููุงุช ุงูุฑุฆูุณูุฉ:**

- โ **ุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ**: ุชู ุงูุชุนุฏูู ููุนูู ูุน `Contact` ู `ContactGroup` ุงูููุฌูุฏูู
- โ **ุฅุฒุงูุฉ ุงูุจูุงูุงุช ุงูููููุฉ**: ุงุณุชุจุฏุงู ุฌููุน ุงูุจูุงูุงุช ุงููุคูุชุฉ ุจูุฑุงุกุฉ ุญููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ **ููุชุฑ ุขุฎุฑ 90 ููู**: ุฅุถุงูุฉ ููุชุฑุฉ ุชููุงุฆูุฉ ูุฅุธูุงุฑ ุงูุฌูุงุช ุงููุดุทุฉ ูู ุขุฎุฑ 90 ููู ููุท
- โ **ุงููุฌููุนุฉ ุงูุงูุชุฑุงุถูุฉ**: ุฅุถุงูุฉ "ูุฑูู ุงูุนูู ุงูุฑุฆูุณู" ุชููุงุฆูุงู ุนูุฏูุง ูุง ุชูุฌุฏ ูุฌููุนุงุช
- โ **ุงูุจุญุซ ุงููุชูุฏู**: ุฏุนู ุงูุจุญุซ ุจุงูุงุณู ุฃู ุงูุฑูู ูุน ููุชุฑ ุงูููุช

**ูููู ุงูููุงุฐุฌ ุงููุณุชุฎุฏู:**

```javascript
// ุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ
this.Contact = require('../../../models/Contact');
this.ContactGroup = require('../../../models/ContactGroup');

// ููุชุฑ ุขุฎุฑ 90 ููู
const ninetyDaysAgo = new Date();
ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);

// ุงุณุชุนูุงู ูุญุณู ูุน ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ
{
    user_id: userId,
    place_id: placeId,
    status: 'active',
    $or: [
        { last_interaction: { $gte: ninetyDaysAgo } },
        { last_seen: { $gte: ninetyDaysAgo } },
        { created_at: { $gte: ninetyDaysAgo } }
    ]
}
```

### 2. ุชุญุฏูุซ ContactFetchingService.js

**ุงูุชุญุณููุงุช ุงูุฑุฆูุณูุฉ:**

- โ **ุงูุชูุงูู ูุน ุงูููุงุฐุฌ**: ุชุนุฏูู ุงูุนูู ูุน `Contact` ู `ContactGroup` ุงูููุฌูุฏูู
- โ **ููุชุฑุฉ ุฐููุฉ**: ุชุฑููุฒ ุนูู ุงูุฌูุงุช ุงููุดุทุฉ ูู ุขุฎุฑ 90 ููู
- โ **ุฅูุดุงุก ุงููุฌููุนุงุช**: ุฅูุดุงุก ุงููุฌููุนุฉ ุงูุงูุชุฑุงุถูุฉ ุชููุงุฆูุงู ูุน ุงูุฌูุงุช ุงููููุชุฑุฉ
- โ **ูุนุงูุฌุฉ ูุญุณูุฉ**: ุชุญุณูู ููุทู ุฅูุดุงุก ูุชุญุฏูุซ ุฌูุงุช ุงูุงุชุตุงู
- โ **ุฅุญุตุงุฆูุงุช ููุตูุฉ**: ุฅุถุงูุฉ ุชูุงุฑูุฑ ุชูุตูููุฉ ุนู ุนุฏุฏ ุงูุฌูุงุช ูู ูุชุฑุงุช ุฒูููุฉ ูุฎุชููุฉ

**ูุซุงู ุนูู ุฅูุดุงุก ุงููุฌููุนุฉ ุงูุงูุชุฑุงุถูุฉ:**

```javascript
const newDefaultGroup = new this.ContactGroup({
    user_id: userId,
    place_id: placeId,
    session_id: sessionId,
    group_id: `default_${userId}_${placeId}`,
    name: 'ูุฑูู ุงูุนูู ุงูุฑุฆูุณู',
    description: 'ุฌููุน ุฌูุงุช ุงูุงุชุตุงู ุงููุดุทุฉ ูู ุขุฎุฑ 90 ููู',
    contact_ids: contactIds, // ุฌูุงุช ุขุฎุฑ 90 ููู ููุท
    group_type: 'auto',
    filter_criteria: {
        last_interaction_days: 90
    }
});
```

## ๐ง ุงูููุงุฐุฌ ุงููุณุชุฎุฏูุฉ (ุงูููุฌูุฏุฉ ูู ุงููุดุฑูุน)

### Contact.js
```javascript
// ุงูุญููู ุงููุณุชุฎุฏูุฉ ูู ุงูููุชุฑุฉ
{
    user_id: Number,
    place_id: Number,
    contact_id: String,
    name: String,
    number: String,
    last_interaction: Date,
    last_seen: Date,
    status: String, // 'active', 'blocked', 'deleted'
    created_at: Date
}
```

### ContactGroup.js
```javascript
// ุงูุญููู ุงููุณุชุฎุฏูุฉ ูู ุงููุฌููุนุงุช
{
    user_id: Number,
    place_id: Number,
    group_id: String,
    name: String,
    description: String,
    contact_ids: [ObjectId], // ูุฑุฌุน ููุฌูุงุช
    group_type: String, // 'auto', 'manual', 'filtered'
    filter_criteria: Object,
    is_active: Boolean
}
```

## ๐ก ุงููุงุฌูุงุช ุงูุจุฑูุฌูุฉ ุงููุญุฏุซุฉ

### 1. GET /api/whatsapp/groups

**ุงูุงุณุชุฌุงุจุฉ ุงููุญุฏุซุฉ:**

```json
{
    "success": true,
    "data": {
        "groups": [
            {
                "id": "default_123_456",
                "name": "ูุฑูู ุงูุนูู ุงูุฑุฆูุณู",
                "type": "auto",
                "contact_count": 250,
                "filter_applied": "last_90_days"
            }
        ],
        "date_filter": {
            "type": "last_90_days",
            "from_date": "2024-10-28T12:00:00.000Z",
            "to_date": "2025-01-28T12:00:00.000Z"
        }
    }
}
```

### 2. GET /api/whatsapp/groups/:group_id/contacts

**ุงููุนุงููุงุช:**

- `search`: ุงูุจุญุซ ูู ุงูุฃุณูุงุก ูุงูุฃุฑูุงู
- `search_type`: ููุน ุงูุจุญุซ (`name`, `phone`, `all`)

**ุงูุงุณุชุฌุงุจุฉ:**

```json
{
    "success": true,
    "data": {
        "group": {
            "id": "default_123_456",
            "name": "ูุฑูู ุงูุนูู ุงูุฑุฆูุณู",
            "filter_applied": "last_90_days"
        },
        "contacts": [
            {
                "id": "contact_objectid",
                "name": "ุฃุญูุฏ ูุญูุฏ",
                "phone_number": "201234567890",
                "last_interaction": "2025-01-15T10:30:00Z"
            }
        ],
        "date_filter": {
            "type": "last_90_days",
            "from_date": "2024-10-28T12:00:00.000Z",
            "to_date": "2025-01-28T12:00:00.000Z"
        }
    }
}
```

## ๐งช ุทุฑู ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงููุฌููุนุงุช

```bash
# ุฌูุจ ุงููุฌููุนุงุช
curl "http://localhost:5000/api/whatsapp/groups?user_id=123&place_id=456"

# ุฌูุจ ุฌูุงุช ูุฌููุนุฉ ูุนููุฉ (ุณุชุธูุฑ ุงููุฌููุนุฉ ุงูุงูุชุฑุงุถูุฉ)
curl "http://localhost:5000/api/whatsapp/groups/default_123_456/contacts?user_id=123&place_id=456"

# ุงูุจุญุซ ูู ุงููุฌููุนุฉ
curl "http://localhost:5000/api/whatsapp/groups/default_123_456/contacts?user_id=123&place_id=456&search=ุฃุญูุฏ&search_type=name"
```

### ุงุฎุชุจุงุฑ ุงููุฒุงููุฉ

```bash
# ุจุฏุก ูุฒุงููุฉ ุงูุฌูุงุช (ุณุชูุดุฆ ุงููุฌููุนุฉ ุงูุงูุชุฑุงุถูุฉ ุชููุงุฆูุงู)
curl -X POST "http://localhost:5000/api/whatsapp/start-contact-fetch" \
  -H "Content-Type: application/json" \
  -d '{"user_id": 123, "place_id": 456}'
```

## ๐ ูุนุงููุฑ ุงูููุชุฑุฉ

### ุฌูุฉ ุงูุงุชุตุงู "ูุดุทุฉ" ุฅุฐุง ูุงู ูุฏููุง ูุงุญุฏ ูู ุงูุชุงูู ูู ุขุฎุฑ 90 ููู:

1. **ุขุฎุฑ ุชูุงุนู** (`last_interaction`): ุขุฎุฑ ูุฑุฉ ุชู ุงูุชูุงุตู ูุนูุง
2. **ุขุฎุฑ ุธููุฑ** (`last_seen`): ุขุฎุฑ ูุฑุฉ ุธูุฑุช ูููุง ูู ูุงุชุณุงุจ  
3. **ุชุงุฑูุฎ ุงูุฅูุดุงุก** (`created_at`): ุฅุฐุง ุชูุช ุฅุถุงูุชูุง ุญุฏูุซุงู

### ุงูุณููู ุงูุงูุชุฑุงุถู:

- **ูุง ุชูุฌุฏ ูุฌููุนุงุช**: ุณูุชู ุฅูุดุงุก "ูุฑูู ุงูุนูู ุงูุฑุฆูุณู" ุชููุงุฆูุงู
- **ุงููุฌููุนุฉ ุงูุงูุชุฑุงุถูุฉ**: ุชุญุชูู ุนูู ุฌููุน ุงูุฌูุงุช ูู ุขุฎุฑ 90 ููู
- **ุงูุจุญุซ**: ูุนูู ุนูู ุงูุฃุณูุงุก ูุงูุฃุฑูุงู ูุน ุงูุญูุงุธ ุนูู ููุชุฑ 90 ููู

## โ๏ธ ููุงุท ูููุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงููุธุงู ูุณุชุฎุฏู ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ `Contact` ู `ContactGroup`
- ูุง ุญุงุฌุฉ ูุฅูุดุงุก ููุงุฐุฌ ุฌุฏูุฏุฉ
- ุงูููุงุฑุณ ุงูููุฌูุฏุฉ ูุงููุฉ ููุฃุฏุงุก ุงูุฌูุฏ

### 2. ุงูุฃุฏุงุก
- ููุชุฑ ุขุฎุฑ 90 ููู ูุญุณู ุงูุฃุฏุงุก ุจุชูููู ุนุฏุฏ ุงูุณุฌูุงุช
- ุงูุงุณุชุนูุงูุงุช ูุญุณูุฉ ููุนูู ูุน ุงูููุงุฑุณ ุงูููุฌูุฏุฉ

### 3. ุงูุชูุงูู
- ุฌููุน ุงูุชุญุฏูุซุงุช ูุชูุงููุฉ ูุน ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ
- ูุง ุชูุฌุฏ ุชุบููุฑุงุช ูุทููุจุฉ ูู ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ

## โ ุงูููุฎุต ุงูููุงุฆู

๐ฏ **ุชู ุงูุฅุตูุงุญ**: ุงููุธุงู ุงูุขู ูุฌูุจ ุงูุจูุงูุงุช ุงูุญููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ  
๐ฏ **ุชู ุงูุชุทุจูู**: ููุชุฑ ุขุฎุฑ 90 ููู ูุนูู ุนูู ุฌููุน ุงูุฌูุงุช ูุงููุฌููุนุงุช  
๐ฏ **ุชู ุงูุชุญุณูู**: ุฃุฏุงุก ุฃูุถู ููุงุฌูุงุช ุจุฑูุฌูุฉ ูุญุณูุฉ ูุน ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ  
๐ฏ **ุชู ุงูุงุฎุชุจุงุฑ**: ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุงูุฅูุชุงุฌ ูุน `Contact` ู `ContactGroup`

### ูุง ุณูุญุฏุซ ุงูุขู:

1. **ุงููุฌููุนุฉ ุงูุงูุชุฑุงุถูุฉ**: "ูุฑูู ุงูุนูู ุงูุฑุฆูุณู" ุณุชุธูุฑ ุชููุงุฆูุงู ูุน ุฌููุน ุงูุฌูุงุช ูู ุขุฎุฑ 90 ููู
2. **ุงูุจูุงูุงุช ุงูุญููููุฉ**: ูุง ูุฒูุฏ ูู ุงูุจูุงูุงุช ุงูููููุฉ - ูู ุดูุก ูู ุงููุงุนุฏุฉ ุงููุนููุฉ
3. **ุงูููุชุฑุฉ ุงูุฐููุฉ**: ููุท ุงูุฌูุงุช ุงููุดุทุฉ ูู ุขุฎุฑ 90 ููู ุณุชุธูุฑ
4. **ุงูุจุญุซ**: ูุนูู ุจููุงุกุฉ ุนูู ุงูุฃุณูุงุก ูุงูุฃุฑูุงู
5. **ุงูุฃุฏุงุก**: ูุญุณู ููุนูู ูุน ุขูุงู ุฌูุงุช ุงูุงุชุตุงู

## ๐ ุฎุทูุงุช ูุง ุจุนุฏ ุงููุดุฑ

1. **ุงุฎุชุจุงุฑ API**: ุชุฌุฑุจุฉ ุงููุงุฌูุงุช ุงููุญุฏุซุฉ
2. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก**: ูุชุงุจุนุฉ ุณุฑุนุฉ ุงูุงุณุชุนูุงูุงุช
3. **ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช**: ุงูุชุฃูุฏ ูู ุตุญุฉ ุงูููุชุฑุฉ
4. **ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู**: ุงุฎุชุจุงุฑ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุงูููุงุฆูุฉ

---

**ุงูุขู ุงููุดููุฉ ูุญูููุฉ ุจุงููุงูู ููุชูุงููุฉ ูุน ุงูููุงุฐุฌ ุงูููุฌูุฏุฉ ูู ุงููุดุฑูุน! ๐**